<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=1b0aae57df3176981ebd448f73d104e2e82d29cd">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Feature Detection In OpenCV | channy’s page</title>
<meta name="generator" content="Jekyll v3.7.4" />
<meta property="og:title" content="Feature Detection In OpenCV" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Welcome! This is Qianni Huang(qanny, or you can call me channy), a software engineer mainly in Computer Vision, expecially in 3D reconstruction. But this area is too hard to find a job in my city, so I decide to change my area to Linux network coding. This blog is used to write some notes I learned in CV or others." />
<meta property="og:description" content="Welcome! This is Qianni Huang(qanny, or you can call me channy), a software engineer mainly in Computer Vision, expecially in 3D reconstruction. But this area is too hard to find a job in my city, so I decide to change my area to Linux network coding. This blog is used to write some notes I learned in CV or others." />
<link rel="canonical" href="http://localhost:4000/Feature_Detection_In_OpenCV.html" />
<meta property="og:url" content="http://localhost:4000/Feature_Detection_In_OpenCV.html" />
<meta property="og:site_name" content="channy’s page" />
<script type="application/ld+json">
{"description":"Welcome! This is Qianni Huang(qanny, or you can call me channy), a software engineer mainly in Computer Vision, expecially in 3D reconstruction. But this area is too hard to find a job in my city, so I decide to change my area to Linux network coding. This blog is used to write some notes I learned in CV or others.","@type":"WebPage","url":"http://localhost:4000/Feature_Detection_In_OpenCV.html","headline":"Feature Detection In OpenCV","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>

    <header>
      <div class="container">
        <h1>channy's page</h1>
        <h2>Welcome! This is Qianni Huang(qanny, or you can call me channy), a software engineer mainly in Computer Vision, expecially in 3D reconstruction. But this area is too hard to find a job in my city, so I decide to change my area to Linux network coding. This blog is used to write some notes I learned in CV or others.</h2>

        <section id="downloads">
          
            <a href="http://github.com/qanny/qanny.github.io/zipball/gh-pages" class="btn">Download as .zip</a>
            <a href="http://github.com/qanny/qanny.github.io/tarball/gh-pages" class="btn">Download as .tar.gz</a>
          
          <a href="http://github.com/qanny/qanny.github.io" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <h1 id="feature-detection-in-opencv">Feature Detection In OpenCV</h1>

<p>Here we will analyse the implement of Feature Detection in Opencv3.</p>

<p>At the beginning, let’s see how to use opencv to detect features.</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;opencv2/core/utility.hpp&gt;
#include &lt;opencv2/imgproc.hpp&gt;
#include &lt;opencv2/imgcodecs.hpp&gt;
#include &lt;opencv2/highgui.hpp&gt;
#include &lt;opencv2/core/core.hpp&gt;
#include &lt;opencv2/opencv.hpp&gt;
#include &lt;opencv2/features2d/features2d.hpp&gt;
</span>
<span class="cp">#include &lt;cstdio&gt;
#include &lt;iostream&gt;
</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">cv</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span> <span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span> <span class="p">)</span> <span class="p">{</span>
	<span class="n">cv</span><span class="o">::</span><span class="n">CommandLineParser</span> <span class="n">parser</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="s">"{ @input | ./fruits.jpg | }"</span><span class="p">);</span>
    
	<span class="n">string</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"@input"</span><span class="p">);</span>
	<span class="n">Mat</span> <span class="n">img</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="n">imgGray</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span> <span class="n">img</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Couldn'g open image "</span> <span class="o">&lt;&lt;</span> <span class="n">filename</span> <span class="o">&lt;&lt;</span> <span class="s">". Usage: detect &lt;image_name&gt;</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
	<span class="n">namedWindow</span><span class="p">(</span> <span class="s">"image"</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
	<span class="n">imshow</span><span class="p">(</span><span class="s">"image"</span><span class="p">,</span> <span class="n">img</span><span class="p">);</span>
	
	<span class="k">if</span> <span class="p">(</span><span class="n">img</span><span class="p">.</span><span class="n">channels</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">imgGray</span><span class="p">,</span> <span class="n">COLOR_BGR2GRAY</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">img</span><span class="p">.</span><span class="n">copyTo</span><span class="p">(</span><span class="n">imgGray</span><span class="p">);</span>
	<span class="p">}</span>
	
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">KeyPoint</span><span class="o">&gt;</span> <span class="n">detectKeyPoint</span><span class="p">;</span>
	<span class="n">Mat</span> <span class="n">imgWithKeyPoint</span><span class="p">;</span>

	<span class="c1">//Fast
</span>	<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">FeatureDetector</span><span class="o">&gt;</span> <span class="n">detector</span> <span class="o">=</span> <span class="n">FastFeatureDetector</span><span class="o">::</span><span class="n">create</span><span class="p">();</span>
	<span class="n">detector</span><span class="o">-&gt;</span><span class="n">detect</span><span class="p">(</span><span class="n">imgGray</span><span class="p">,</span> <span class="n">detectKeyPoint</span><span class="p">);</span>
	<span class="n">drawKeypoints</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">detectKeyPoint</span><span class="p">,</span> <span class="n">imgWithKeyPoint</span><span class="p">,</span> <span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">DrawMatchesFlags</span><span class="o">::</span><span class="n">DRAW_RICH_KEYPOINTS</span><span class="p">);</span>
	<span class="n">namedWindow</span><span class="p">(</span><span class="s">"FAST"</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">imshow</span><span class="p">(</span><span class="s">"FAST"</span><span class="p">,</span> <span class="n">imgWithKeyPoint</span><span class="p">);</span>
	
	<span class="c1">//AKAZE
</span>	<span class="n">detector</span> <span class="o">=</span> <span class="n">AKAZE</span><span class="o">::</span><span class="n">create</span><span class="p">();</span>
	<span class="n">detector</span><span class="o">-&gt;</span><span class="n">detect</span><span class="p">(</span><span class="n">imgGray</span><span class="p">,</span> <span class="n">detectKeyPoint</span><span class="p">);</span>
	<span class="n">drawKeypoints</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">detectKeyPoint</span><span class="p">,</span> <span class="n">imgWithKeyPoint</span><span class="p">,</span> <span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">DrawMatchesFlags</span><span class="o">::</span><span class="n">DRAW_RICH_KEYPOINTS</span><span class="p">);</span>
	<span class="n">namedWindow</span><span class="p">(</span><span class="s">"akaze"</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">imshow</span><span class="p">(</span><span class="s">"akaze"</span><span class="p">,</span> <span class="n">imgWithKeyPoint</span><span class="p">);</span>
	
	<span class="c1">//Brisk
</span>	<span class="n">detector</span> <span class="o">=</span> <span class="n">BRISK</span><span class="o">::</span><span class="n">create</span><span class="p">();</span>
	<span class="n">detector</span><span class="o">-&gt;</span><span class="n">detect</span><span class="p">(</span><span class="n">imgGray</span><span class="p">,</span> <span class="n">detectKeyPoint</span><span class="p">);</span>
	<span class="n">drawKeypoints</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">detectKeyPoint</span><span class="p">,</span> <span class="n">imgWithKeyPoint</span><span class="p">,</span> <span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">DrawMatchesFlags</span><span class="o">::</span><span class="n">DRAW_RICH_KEYPOINTS</span><span class="p">);</span>
	<span class="n">namedWindow</span><span class="p">(</span><span class="s">"Brisk"</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">imshow</span><span class="p">(</span><span class="s">"Brisk"</span><span class="p">,</span> <span class="n">imgWithKeyPoint</span><span class="p">);</span>
	
	<span class="c1">//GoodFeaturesToTrack
</span>	<span class="n">detector</span> <span class="o">=</span> <span class="n">GFTTDetector</span><span class="o">::</span><span class="n">create</span><span class="p">();</span>
	<span class="n">detector</span><span class="o">-&gt;</span><span class="n">detect</span><span class="p">(</span><span class="n">imgGray</span><span class="p">,</span> <span class="n">detectKeyPoint</span><span class="p">);</span>
	<span class="n">drawKeypoints</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">detectKeyPoint</span><span class="p">,</span> <span class="n">imgWithKeyPoint</span><span class="p">,</span> <span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">DrawMatchesFlags</span><span class="o">::</span><span class="n">DRAW_RICH_KEYPOINTS</span><span class="p">);</span>
	<span class="n">namedWindow</span><span class="p">(</span><span class="s">"GoodFeaturesToTrack"</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">imshow</span><span class="p">(</span><span class="s">"GoodFeaturesToTrack"</span><span class="p">,</span> <span class="n">imgWithKeyPoint</span><span class="p">);</span>
	
	<span class="c1">//ORB
</span>	<span class="n">detector</span> <span class="o">=</span> <span class="n">ORB</span><span class="o">::</span><span class="n">create</span><span class="p">();</span>
	<span class="n">detector</span><span class="o">-&gt;</span><span class="n">detect</span><span class="p">(</span><span class="n">imgGray</span><span class="p">,</span> <span class="n">detectKeyPoint</span><span class="p">);</span>
	<span class="n">drawKeypoints</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">detectKeyPoint</span><span class="p">,</span> <span class="n">imgWithKeyPoint</span><span class="p">,</span> <span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">DrawMatchesFlags</span><span class="o">::</span><span class="n">DRAW_RICH_KEYPOINTS</span><span class="p">);</span>
	<span class="n">namedWindow</span><span class="p">(</span><span class="s">"ORB"</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">imshow</span><span class="p">(</span><span class="s">"ORB"</span><span class="p">,</span> <span class="n">imgWithKeyPoint</span><span class="p">);</span>
	
	<span class="c1">//MSER
</span>	<span class="n">detector</span> <span class="o">=</span> <span class="n">MSER</span><span class="o">::</span><span class="n">create</span><span class="p">();</span>
	<span class="n">detector</span><span class="o">-&gt;</span><span class="n">detect</span><span class="p">(</span><span class="n">imgGray</span><span class="p">,</span> <span class="n">detectKeyPoint</span><span class="p">);</span>
	<span class="n">drawKeypoints</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">detectKeyPoint</span><span class="p">,</span> <span class="n">imgWithKeyPoint</span><span class="p">,</span> <span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">DrawMatchesFlags</span><span class="o">::</span><span class="n">DRAW_RICH_KEYPOINTS</span><span class="p">);</span>
	<span class="n">namedWindow</span><span class="p">(</span><span class="s">"MSER"</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">imshow</span><span class="p">(</span><span class="s">"MSER"</span><span class="p">,</span> <span class="n">imgWithKeyPoint</span><span class="p">);</span>
	
	<span class="c1">//SimpleBlobDetector
</span>	<span class="n">detector</span> <span class="o">=</span> <span class="n">SimpleBlobDetector</span><span class="o">::</span><span class="n">create</span><span class="p">();</span>
	<span class="n">detector</span><span class="o">-&gt;</span><span class="n">detect</span><span class="p">(</span><span class="n">imgGray</span><span class="p">,</span> <span class="n">detectKeyPoint</span><span class="p">);</span>
	<span class="n">drawKeypoints</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">detectKeyPoint</span><span class="p">,</span> <span class="n">imgWithKeyPoint</span><span class="p">,</span> <span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">DrawMatchesFlags</span><span class="o">::</span><span class="n">DRAW_RICH_KEYPOINTS</span><span class="p">);</span>
	<span class="n">namedWindow</span><span class="p">(</span><span class="s">"SimpleBlobDetector"</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">imshow</span><span class="p">(</span><span class="s">"SimpleBlobDetector"</span><span class="p">,</span> <span class="n">imgWithKeyPoint</span><span class="p">);</span>

	
	<span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Then we will begin from: <code class="highlighter-rouge">FastFeatureDetector::create()</code></p>

<blockquote>
  <p>actually, it is: (feature2d/src/fast.cpp)</p>
</blockquote>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">FastFeatureDetector</span><span class="o">&gt;</span> <span class="n">FastFeatureDetector</span><span class="o">::</span><span class="n">create</span><span class="p">(</span> <span class="kt">int</span> <span class="n">threshold</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">nonmaxSuppression</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">makePtr</span><span class="o">&lt;</span><span class="n">FastFeatureDetector_Impl</span><span class="o">&gt;</span><span class="p">(</span><span class="n">threshold</span><span class="p">,</span> <span class="n">nonmaxSuppression</span><span class="p">,</span> <span class="n">type</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<p>After create ptr, then we enter detect function of <code class="highlighter-rouge">FastFeatureDetector_Impl</code>:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">detect</span><span class="p">(</span> <span class="n">InputArray</span> <span class="n">_image</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">KeyPoint</span><span class="o">&gt;&amp;</span> <span class="n">keypoints</span><span class="p">,</span> <span class="n">InputArray</span> <span class="n">_mask</span> <span class="p">)</span> <span class="p">{</span>
	<span class="n">Mat</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">_mask</span><span class="p">.</span><span class="n">getMat</span><span class="p">(),</span> <span class="n">grayImage</span><span class="p">;</span>
	<span class="n">UMat</span> <span class="n">ugrayImage</span><span class="p">;</span>
	<span class="n">_InputArray</span> <span class="n">gray</span> <span class="o">=</span> <span class="n">_image</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span> <span class="n">_image</span><span class="p">.</span><span class="n">type</span><span class="p">()</span> <span class="o">!=</span> <span class="n">CV_8U</span> <span class="p">)</span>
	<span class="p">{</span>
		<span class="n">_OutputArray</span> <span class="n">ogray</span> <span class="o">=</span> <span class="n">_image</span><span class="p">.</span><span class="n">isUMat</span><span class="p">()</span> <span class="o">?</span> <span class="n">_OutputArray</span><span class="p">(</span><span class="n">ugrayImage</span><span class="p">)</span> <span class="o">:</span> <span class="n">_OutputArray</span><span class="p">(</span><span class="n">grayImage</span><span class="p">);</span>
		<span class="n">cvtColor</span><span class="p">(</span> <span class="n">_image</span><span class="p">,</span> <span class="n">ogray</span><span class="p">,</span> <span class="n">COLOR_BGR2GRAY</span> <span class="p">);</span>
		<span class="n">gray</span> <span class="o">=</span> <span class="n">ogray</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">FAST</span><span class="p">(</span> <span class="n">gray</span><span class="p">,</span> <span class="n">keypoints</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">nonmaxSuppression</span><span class="p">,</span> <span class="n">type</span> <span class="p">);</span>
	<span class="n">KeyPointsFilter</span><span class="o">::</span><span class="n">runByPixelsMask</span><span class="p">(</span> <span class="n">keypoints</span><span class="p">,</span> <span class="n">mask</span> <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<p>First, we need to convert input image to gray image.</p>

<p>Then, follow the kernel function <em>FAST</em>, actually in <em>FAST_t</em>:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="kt">int</span> <span class="n">patternSize</span><span class="o">&gt;</span>
<span class="kt">void</span> <span class="n">FAST_t</span><span class="p">(</span><span class="n">InputArray</span> <span class="n">_img</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">KeyPoint</span><span class="o">&gt;&amp;</span> <span class="n">keypoints</span><span class="p">,</span> <span class="kt">int</span> <span class="n">threshold</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">nonmax_suppression</span><span class="p">)</span>
</code></pre></div></div>

<p><a href="./">back</a></p>

      </section>
    </div>

    
  </body>
</html>
