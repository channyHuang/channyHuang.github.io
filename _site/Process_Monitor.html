<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=84ac09b8602d6a8196b5d7394b398209d943550f">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>channy’s page | Welcome! This is Qianni Huang(qanny, or you can call me channy), a software engineer mainly in Computer Vision, expecially in 3D reconstruction. But this area is too hard to find a job in my city, so I decide to change my area to Linux network coding. This blog is used to write some notes I learned in CV or others.</title>
<meta name="generator" content="Jekyll v3.7.4" />
<meta property="og:title" content="channy’s page" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Welcome! This is Qianni Huang(qanny, or you can call me channy), a software engineer mainly in Computer Vision, expecially in 3D reconstruction. But this area is too hard to find a job in my city, so I decide to change my area to Linux network coding. This blog is used to write some notes I learned in CV or others." />
<meta property="og:description" content="Welcome! This is Qianni Huang(qanny, or you can call me channy), a software engineer mainly in Computer Vision, expecially in 3D reconstruction. But this area is too hard to find a job in my city, so I decide to change my area to Linux network coding. This blog is used to write some notes I learned in CV or others." />
<link rel="canonical" href="http://localhost:4000/Process_Monitor.html" />
<meta property="og:url" content="http://localhost:4000/Process_Monitor.html" />
<meta property="og:site_name" content="channy’s page" />
<script type="application/ld+json">
{"@type":"WebPage","headline":"channy’s page","url":"http://localhost:4000/Process_Monitor.html","description":"Welcome! This is Qianni Huang(qanny, or you can call me channy), a software engineer mainly in Computer Vision, expecially in 3D reconstruction. But this area is too hard to find a job in my city, so I decide to change my area to Linux network coding. This blog is used to write some notes I learned in CV or others.","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>

    <header>
      <div class="container">
        <h1>channy's page</h1>
        <h2>Welcome! This is Qianni Huang(qanny, or you can call me channy), a software engineer mainly in Computer Vision, expecially in 3D reconstruction. But this area is too hard to find a job in my city, so I decide to change my area to Linux network coding. This blog is used to write some notes I learned in CV or others.</h2>

        <section id="downloads">
          
            <a href="http://github.com/qanny/qanny.github.io/zipball/gh-pages" class="btn">Download as .zip</a>
            <a href="http://github.com/qanny/qanny.github.io/tarball/gh-pages" class="btn">Download as .tar.gz</a>
          
          <a href="http://github.com/qanny/qanny.github.io" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <p>//Author: channy</p>

<p>//Create Date: 2019-04-12 22:26:52</p>

<p>//Description:</p>

<h1 id="process_monitormd">Process_Monitor.md</h1>

<p>At the beginning, is there any api which can get exec file verison in linux?
在linux下有没有类似于winapi-GetFileVersion获取可执行文件版本号的方法？</p>

<p>Monitor one process, including memroy usage, cpu percentage, running time, etc.</p>

<h2 id="get-file-version">get file version</h2>
<p>windows</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">LPCWSTR</span> <span class="n">lpFullPathFile</span> <span class="o">=</span> <span class="p">(</span><span class="n">LPCWSTR</span><span class="p">)</span><span class="n">sFullPathFile</span><span class="p">.</span><span class="n">unicode</span><span class="p">();</span>
    <span class="n">DWORD</span> <span class="n">dwInfoSize</span> <span class="o">=</span> <span class="n">GetFileVersionInfoSize</span><span class="p">(</span><span class="n">lpFullPathFile</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&gt;=</span> <span class="n">dwInfoSize</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//Log::info(QString().sprintf("error when getFileVersion of file %s, errorCode = %ld.", sFullPathFile.toStdString().c_str(), GetLastError()));
</span>        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">char</span> <span class="o">*</span><span class="n">pInfoBuf</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">dwInfoSize</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">false</span> <span class="o">==</span> <span class="n">GetFileVersionInfo</span><span class="p">(</span><span class="n">lpFullPathFile</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">dwInfoSize</span><span class="p">,</span><span class="n">pInfoBuf</span> <span class="p">))</span>
    <span class="p">{</span>
        <span class="c1">//Log::info(QString().sprintf("error when getFileVersion of file %s, errorCode = %ld", sFullPathFile.toStdString().c_str(), GetLastError()));
</span>        <span class="k">delete</span> <span class="p">[]</span> <span class="n">pInfoBuf</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dwInfoValSize</span><span class="p">;</span>
    <span class="n">VS_FIXEDFILEINFO</span> <span class="o">*</span><span class="n">pInfoVal</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

    <span class="n">VerQueryValue</span><span class="p">(</span><span class="n">pInfoBuf</span><span class="p">,</span> <span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"</span><span class="se">\\</span><span class="s">"</span><span class="p">)),</span> <span class="p">(</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">pInfoVal</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dwInfoValSize</span><span class="p">);</span>
    <span class="k">delete</span> <span class="p">[]</span> <span class="n">pInfoBuf</span><span class="p">;</span>

    <span class="n">sProcVersion</span>  <span class="o">=</span> <span class="n">QString</span><span class="p">().</span><span class="n">sprintf</span><span class="p">(</span><span class="s">"%d.%d.%d.%d"</span><span class="p">,</span>
                                        <span class="n">HIWORD</span><span class="p">(</span><span class="n">pInfoVal</span><span class="o">-&gt;</span><span class="n">dwFileVersionMS</span><span class="p">),</span> <span class="n">LOWORD</span><span class="p">(</span><span class="n">pInfoVal</span><span class="o">-&gt;</span><span class="n">dwFileVersionMS</span><span class="p">),</span>
                                        <span class="n">HIWORD</span><span class="p">(</span><span class="n">pInfoVal</span><span class="o">-&gt;</span><span class="n">dwFileVersionLS</span><span class="p">),</span> <span class="n">LOWORD</span><span class="p">(</span><span class="n">pInfoVal</span><span class="o">-&gt;</span><span class="n">dwFileVersionLS</span><span class="p">));</span>
</code></pre></div></div>

<h2 id="get-file-info-modifytime-filesize-etc">get file info (modifyTime, fileSize, etc)</h2>
<p>can use Qt api QFileInfo, cross platform</p>

<h2 id="get-system-version-win-or-linux">get system version (win or linux)</h2>
<p>In windows can use Qt api QSysInfo::windowsVersion(), while in linux,</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">struct</span> <span class="n">utsname</span> <span class="n">uts</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">uname</span><span class="p">(</span><span class="o">&amp;</span><span class="n">uts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">m_sSystemVersion</span> <span class="o">=</span> <span class="n">QString</span><span class="p">().</span><span class="n">sprintf</span><span class="p">(</span><span class="s">"sysname = %s, release = %s, version = %s, machine = %s"</span><span class="p">,</span>
                                              <span class="n">uts</span><span class="p">.</span><span class="n">sysname</span><span class="p">,</span> <span class="n">uts</span><span class="p">.</span><span class="n">release</span><span class="p">,</span> <span class="n">uts</span><span class="p">.</span><span class="n">version</span><span class="p">,</span> <span class="n">uts</span><span class="p">.</span><span class="n">machine</span><span class="p">);</span>
</code></pre></div></div>

<h2 id="get-boot-time">get boot time</h2>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#ifdef Q_OS_WIN
</span>    <span class="n">LARGE_INTEGER</span> <span class="n">t</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">m_nLastPerformanceCounter</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">QueryPerformanceFrequency</span><span class="p">(</span><span class="o">&amp;</span><span class="n">t</span><span class="p">);</span>
        <span class="n">m_nLastPerformanceCounter</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">QuadPart</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">m_nLastPerformanceCounter</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">QueryPerformanceCounter</span><span class="p">(</span><span class="o">&amp;</span><span class="n">t</span><span class="p">);</span>
    <span class="n">m_nPCStartSeconds</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">QuadPart</span> <span class="o">/</span> <span class="n">m_nLastPerformanceCounter</span><span class="p">;</span>
    <span class="n">m_nPCStartMSecs</span> <span class="o">=</span><span class="p">(</span><span class="kt">double</span><span class="p">)(</span><span class="n">t</span><span class="p">.</span><span class="n">QuadPart</span> <span class="o">-</span> <span class="n">m_nPCStartSeconds</span> <span class="o">*</span> <span class="n">m_nLastPerformanceCounter</span><span class="p">)</span><span class="o">*</span><span class="mi">1000000</span> <span class="o">/</span> <span class="n">m_nLastPerformanceCounter</span><span class="p">;</span>
<span class="cp">#elif defined Q_OS_LINUX
</span>    <span class="k">struct</span> <span class="n">sysinfo</span> <span class="n">s_info</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">sysinfo</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s_info</span><span class="p">))</span>
        <span class="n">m_nPCStartSeconds</span> <span class="o">=</span> <span class="n">s_info</span><span class="p">.</span><span class="n">uptime</span><span class="p">;</span>
    <span class="n">m_nPCStartMSecs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="cp">#endif
</span></code></pre></div></div>

<h2 id="get-disk-free-space">get disk free space</h2>
<p>windows</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#ifdef Q_OS_WIN
</span>    <span class="n">LPCWSTR</span> <span class="n">lpcwstrDriver</span><span class="o">=</span><span class="p">(</span><span class="n">LPCWSTR</span><span class="p">)</span><span class="n">sDriver</span><span class="p">.</span><span class="n">utf16</span><span class="p">();</span>
    <span class="n">ULARGE_INTEGER</span> <span class="n">liFreeBytesAvailable</span><span class="p">,</span> <span class="n">liTotalBytes</span><span class="p">,</span> <span class="n">liTotalFreeBytes</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">GetDiskFreeSpaceEx</span><span class="p">(</span> <span class="n">lpcwstrDriver</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">liFreeBytesAvailable</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">liTotalBytes</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">liTotalFreeBytes</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">nDiskFreeSpace</span> <span class="o">=</span> <span class="n">liTotalFreeBytes</span><span class="p">.</span><span class="n">QuadPart</span> <span class="o">/</span> <span class="n">BYTETOM</span><span class="p">;</span> <span class="c1">//MB
</span>    <span class="n">nDiskTotalSpace</span> <span class="o">=</span> <span class="n">liTotalBytes</span><span class="p">.</span><span class="n">QuadPart</span> <span class="o">/</span> <span class="n">BYTETOM</span><span class="p">;</span>
<span class="cp">#elif defined Q_OS_LINUX
</span>    <span class="k">struct</span> <span class="n">statfs</span> <span class="n">buf</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&gt;</span> <span class="n">statfs</span><span class="p">(</span><span class="n">sDriver</span><span class="p">.</span><span class="n">toStdString</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">buf</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">nDiskTotalSpace</span> <span class="o">=</span> <span class="p">((</span><span class="kt">long</span> <span class="kt">long</span><span class="p">)</span> <span class="n">buf</span><span class="p">.</span><span class="n">f_bsize</span> <span class="o">*</span> <span class="p">(</span><span class="kt">long</span> <span class="kt">long</span><span class="p">)</span> <span class="n">buf</span><span class="p">.</span><span class="n">f_blocks</span><span class="p">)</span> <span class="o">/</span> <span class="n">BYTETOM</span><span class="p">;</span>
    <span class="n">nDiskFreeSpace</span> <span class="o">=</span> <span class="p">((</span><span class="kt">long</span> <span class="kt">long</span><span class="p">)</span> <span class="n">buf</span><span class="p">.</span><span class="n">f_bsize</span> <span class="o">*</span> <span class="p">(</span><span class="kt">long</span> <span class="kt">long</span><span class="p">)</span> <span class="n">buf</span><span class="p">.</span><span class="n">f_bfree</span><span class="p">)</span> <span class="o">/</span> <span class="n">BYTETOM</span><span class="p">;</span>
<span class="cp">#endif
</span></code></pre></div></div>

<h2 id="get-process-id-by-name">get process id by name</h2>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#ifdef Q_OS_WIN
</span>    <span class="n">HANDLE</span> <span class="n">hSnapshot</span> <span class="o">=</span> <span class="n">CreateToolhelp32Snapshot</span><span class="p">(</span><span class="n">TH32CS_SNAPPROCESS</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">INVALID_HANDLE_VALUE</span> <span class="o">==</span> <span class="n">hSnapshot</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">PROCESSENTRY32</span> <span class="n">pe</span><span class="p">;</span>
    <span class="n">pe</span><span class="p">.</span><span class="n">dwSize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">PROCESSENTRY32</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Process32First</span><span class="p">(</span><span class="n">hSnapshot</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pe</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">do</span>
        <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">_stricmp</span><span class="p">(</span><span class="n">WcharToChar</span><span class="p">(</span><span class="n">pe</span><span class="p">.</span><span class="n">szExeFile</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">sProcessName</span><span class="p">.</span><span class="n">toStdString</span><span class="p">().</span><span class="n">c_str</span><span class="p">()))</span>
                <span class="n">vPid</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pe</span><span class="p">.</span><span class="n">th32ProcessID</span><span class="p">);</span>
        <span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="n">Process32Next</span><span class="p">(</span><span class="n">hSnapshot</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pe</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="n">CloseHandle</span><span class="p">(</span><span class="n">hSnapshot</span><span class="p">);</span>
<span class="cp">#elif defined Q_OS_LINUX
</span>    <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">256</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
    <span class="n">QDir</span> <span class="n">dir</span><span class="p">(</span><span class="s">"/proc"</span><span class="p">);</span>
    <span class="n">dir</span><span class="p">.</span><span class="n">setFilter</span><span class="p">(</span><span class="n">QDir</span><span class="o">::</span><span class="n">Dirs</span><span class="p">);</span>
    <span class="n">QFileInfoList</span> <span class="n">fileInfoList</span> <span class="o">=</span> <span class="n">dir</span><span class="p">.</span><span class="n">entryInfoList</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">QFileInfo</span> <span class="n">file</span> <span class="o">:</span> <span class="n">fileInfoList</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">FILE</span> <span class="o">*</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">((</span><span class="n">file</span><span class="p">.</span><span class="n">absoluteFilePath</span><span class="p">()</span> <span class="o">+</span> <span class="s">"/status"</span><span class="p">).</span><span class="n">toStdString</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span> <span class="s">"r"</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">==</span> <span class="n">fp</span><span class="p">)</span>
            <span class="k">continue</span><span class="p">;</span>

        <span class="n">fgets</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
        <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
        <span class="kt">char</span> <span class="n">key</span><span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="n">value</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
        <span class="n">sscanf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">"%s %s"</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">QString</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="n">sProcessName</span><span class="p">)</span>
            <span class="n">vPid</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">file</span><span class="p">.</span><span class="n">fileName</span><span class="p">().</span><span class="n">toInt</span><span class="p">());</span>
    <span class="p">}</span>
<span class="cp">#endif
</span></code></pre></div></div>

<h2 id="get-total-memory-info">get total memory info</h2>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#ifdef Q_OS_WIN
</span>    <span class="n">MEMORYSTATUSEX</span> <span class="n">statex</span><span class="p">;</span>
    <span class="n">statex</span><span class="p">.</span><span class="n">dwLength</span> <span class="o">=</span> <span class="k">sizeof</span> <span class="p">(</span><span class="n">statex</span><span class="p">);</span>
    <span class="n">GlobalMemoryStatusEx</span><span class="p">(</span><span class="o">&amp;</span><span class="n">statex</span><span class="p">);</span>
    <span class="n">Log</span><span class="o">::</span><span class="n">info</span><span class="p">(</span><span class="n">QString</span><span class="p">().</span><span class="n">sprintf</span><span class="p">(</span><span class="s">"physical memory free/total = %lld/%lld(M), "</span>
                                <span class="s">"virtual memory free/total = %lld/%lld(M), "</span>
                                <span class="s">"page file free/total = %lld/%lld(M), "</span>
                                <span class="s">"extended memory = %lld"</span><span class="p">,</span>
                                <span class="n">statex</span><span class="p">.</span><span class="n">ullAvailPhys</span> <span class="o">/</span> <span class="n">BYTETOM</span><span class="p">,</span> <span class="n">statex</span><span class="p">.</span><span class="n">ullTotalPhys</span> <span class="o">/</span> <span class="n">BYTETOM</span><span class="p">,</span>
                                <span class="n">statex</span><span class="p">.</span><span class="n">ullAvailVirtual</span> <span class="o">/</span> <span class="n">BYTETOM</span><span class="p">,</span> <span class="n">statex</span><span class="p">.</span><span class="n">ullTotalVirtual</span> <span class="o">/</span> <span class="n">BYTETOM</span><span class="p">,</span>
                                <span class="n">statex</span><span class="p">.</span><span class="n">ullAvailPageFile</span> <span class="o">/</span> <span class="n">BYTETOM</span><span class="p">,</span> <span class="n">statex</span><span class="p">.</span><span class="n">ullTotalPageFile</span> <span class="o">/</span> <span class="n">BYTETOM</span><span class="p">,</span>
                                <span class="n">statex</span><span class="p">.</span><span class="n">ullAvailExtendedVirtual</span> <span class="o">/</span> <span class="n">BYTETOM</span><span class="p">));</span>
<span class="cp">#elif defined Q_OS_LINUX
</span>    <span class="k">struct</span> <span class="n">sysinfo</span> <span class="n">s_info</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">sysinfo</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s_info</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">Log</span><span class="o">::</span><span class="n">info</span><span class="p">(</span><span class="n">QString</span><span class="p">().</span><span class="n">sprintf</span><span class="p">(</span><span class="s">"totalProcess = %d, memory free/total/shared = %ld/%ld/%ld, memory used = %ld,"</span>
                                  <span class="s">"swap total/free = %ld/%ld, high total/free = %ld/%ld"</span><span class="p">,</span>
                                  <span class="n">s_info</span><span class="p">.</span><span class="n">procs</span><span class="p">,</span> <span class="n">s_info</span><span class="p">.</span><span class="n">freeram</span> <span class="o">/</span> <span class="n">BYTETOM</span><span class="p">,</span> <span class="n">s_info</span><span class="p">.</span><span class="n">totalram</span> <span class="o">/</span> <span class="n">BYTETOM</span><span class="p">,</span> <span class="n">s_info</span><span class="p">.</span><span class="n">sharedram</span> <span class="o">/</span> <span class="n">BYTETOM</span><span class="p">,</span>
                                  <span class="n">s_info</span><span class="p">.</span><span class="n">bufferram</span> <span class="o">/</span> <span class="n">BYTETOM</span><span class="p">,</span>
                                  <span class="n">s_info</span><span class="p">.</span><span class="n">totalswap</span> <span class="o">/</span> <span class="n">BYTETOM</span><span class="p">,</span> <span class="n">s_info</span><span class="p">.</span><span class="n">freeswap</span> <span class="o">/</span> <span class="n">BYTETOM</span><span class="p">,</span> <span class="n">s_info</span><span class="p">.</span><span class="n">totalhigh</span> <span class="o">/</span> <span class="n">BYTETOM</span><span class="p">,</span> <span class="n">s_info</span><span class="p">.</span><span class="n">freehigh</span> <span class="o">/</span> <span class="n">BYTETOM</span><span class="p">));</span>
    <span class="p">}</span>
<span class="cp">#endif
</span></code></pre></div></div>

<h2 id="get-total-cpu-percentage">get total cpu percentage</h2>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#ifdef Q_OS_WIN
</span>    <span class="n">FILETIME</span> <span class="n">ftIdle</span><span class="p">,</span> <span class="n">ftKernel</span><span class="p">,</span> <span class="n">ftUser</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">GetSystemTimes</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ftIdle</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ftKernel</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ftUser</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="kt">double</span> <span class="n">fCPUIdleTime</span> <span class="o">=</span> <span class="n">transferFileTime</span><span class="p">(</span><span class="n">ftIdle</span><span class="p">);</span>
        <span class="kt">double</span> <span class="n">fCPUKernelTime</span> <span class="o">=</span> <span class="n">transferFileTime</span><span class="p">(</span><span class="n">ftKernel</span><span class="p">);</span>
        <span class="kt">double</span> <span class="n">fCPUUserTime</span> <span class="o">=</span> <span class="n">transferFileTime</span><span class="p">(</span><span class="n">ftUser</span><span class="p">);</span>
        <span class="n">nCPUUseRate</span><span class="o">=</span> <span class="mf">100.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">fCPUIdleTime</span> <span class="o">-</span> <span class="n">m_fOldCPUIdleTime</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">fCPUKernelTime</span> <span class="o">-</span> <span class="n">m_fOldCPUKernelTime</span> <span class="o">+</span> <span class="n">fCPUUserTime</span> <span class="o">-</span> <span class="n">m_fOldCPUUserTime</span><span class="p">)</span><span class="o">*</span><span class="mf">100.0</span><span class="p">;</span>
        <span class="n">m_fOldCPUIdleTime</span> <span class="o">=</span> <span class="n">fCPUIdleTime</span><span class="p">;</span>
        <span class="n">m_fOldCPUKernelTime</span> <span class="o">=</span> <span class="n">fCPUKernelTime</span><span class="p">;</span>
        <span class="n">m_fOldCPUUserTime</span> <span class="o">=</span> <span class="n">fCPUUserTime</span><span class="p">;</span>
    <span class="p">}</span>
<span class="cp">#elif defined Q_OS_LINUX
</span>    <span class="kt">int</span> <span class="n">nCPUIdleTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nCPUKernelTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nCPUUserTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nCPUNiceTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">FILE</span> <span class="o">*</span><span class="n">fd</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">"/proc/stat"</span><span class="p">,</span><span class="s">"r"</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">!=</span> <span class="n">fd</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">char</span> <span class="n">buff</span><span class="p">[</span><span class="mi">1024</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
        <span class="n">fgets</span><span class="p">(</span><span class="n">buff</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">buff</span><span class="p">),</span><span class="n">fd</span><span class="p">);</span>
        <span class="n">fclose</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>

        <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">64</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
        <span class="n">sscanf</span><span class="p">(</span><span class="n">buff</span><span class="p">,</span><span class="s">"%s %d %d %d %d"</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="o">&amp;</span><span class="n">nCPUUserTime</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nCPUNiceTime</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nCPUKernelTime</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nCPUIdleTime</span><span class="p">);</span>
        <span class="n">nCPUUseRate</span> <span class="o">=</span> <span class="mf">100.0</span> <span class="o">-</span> <span class="n">nCPUIdleTime</span> <span class="o">*</span> <span class="mf">100.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">nCPUKernelTime</span> <span class="o">+</span> <span class="n">nCPUUserTime</span> <span class="o">+</span> <span class="n">nCPUIdleTime</span><span class="p">);</span>
    <span class="p">}</span>
<span class="cp">#endif
</span></code></pre></div></div>

<h2 id="get-total-process-info">get total process info</h2>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#ifdef Q_OS_WIN
</span>    <span class="n">DWORD</span> <span class="n">dwTotalProcCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">DWORD</span> <span class="n">dwTotalThreadCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">DWORD</span> <span class="n">dwTotalHandleCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">HANDLE</span> <span class="n">hSnapshot</span> <span class="o">=</span> <span class="n">CreateToolhelp32Snapshot</span><span class="p">(</span><span class="n">TH32CS_SNAPPROCESS</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">INVALID_HANDLE_VALUE</span> <span class="o">!=</span> <span class="n">hSnapshot</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">PROCESSENTRY32</span> <span class="n">pe</span><span class="p">;</span>
        <span class="n">pe</span><span class="p">.</span><span class="n">dwSize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">PROCESSENTRY32</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">Process32First</span><span class="p">(</span><span class="n">hSnapshot</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pe</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">do</span>
            <span class="p">{</span>
                <span class="n">dwTotalProcCount</span><span class="o">++</span><span class="p">;</span>
                <span class="n">dwTotalThreadCount</span> <span class="o">+=</span> <span class="n">pe</span><span class="p">.</span><span class="n">cntThreads</span><span class="p">;</span>

                <span class="n">HANDLE</span> <span class="n">handle</span> <span class="o">=</span> <span class="n">OpenProcess</span><span class="p">(</span><span class="n">PROCESS_QUERY_LIMITED_INFORMATION</span><span class="p">,</span> <span class="nb">false</span><span class="p">,</span> <span class="n">pe</span><span class="p">.</span><span class="n">th32ProcessID</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">==</span> <span class="n">handle</span><span class="p">)</span>
                    <span class="k">continue</span><span class="p">;</span>
                <span class="n">DWORD</span> <span class="n">dwHandleCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">false</span> <span class="o">==</span> <span class="n">GetProcessHandleCount</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dwHandleCount</span><span class="p">))</span>
                    <span class="k">continue</span><span class="p">;</span>
                <span class="n">dwTotalHandleCount</span> <span class="o">+=</span> <span class="n">dwHandleCount</span><span class="p">;</span>
            <span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="n">Process32Next</span><span class="p">(</span><span class="n">hSnapshot</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pe</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="n">CloseHandle</span><span class="p">(</span><span class="n">hSnapshot</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">Log</span><span class="o">::</span><span class="n">info</span><span class="p">(</span><span class="n">QString</span><span class="p">().</span><span class="n">sprintf</span><span class="p">(</span><span class="s">"totalProcess = %ld, totalThread = %ld, totalHandle = %ld"</span><span class="p">,</span>
                                <span class="n">dwTotalProcCount</span><span class="p">,</span> <span class="n">dwTotalThreadCount</span><span class="p">,</span> <span class="n">dwTotalHandleCount</span><span class="p">));</span>

<span class="cp">#endif
</span></code></pre></div></div>

<h2 id="get-memory-info-of-each-process">get memory info of each process</h2>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#ifdef Q_OS_WIN
</span>    <span class="n">PROCESS_MEMORY_COUNTERS</span> <span class="n">procMemCounters</span><span class="p">;</span>

    <span class="n">HANDLE</span> <span class="n">hProcess</span> <span class="o">=</span> <span class="n">OpenProcess</span><span class="p">(</span><span class="n">PROCESS_QUERY_LIMITED_INFORMATION</span><span class="p">,</span> <span class="nb">false</span><span class="p">,</span> <span class="n">dwProcessId</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">==</span> <span class="n">hProcess</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="n">res</span> <span class="o">=</span> <span class="n">GetProcessMemoryInfo</span><span class="p">(</span><span class="n">hProcess</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">procMemCounters</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">procMemCounters</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">false</span> <span class="o">==</span> <span class="n">res</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">memoryUsed</span> <span class="o">=</span> <span class="n">procMemCounters</span><span class="p">.</span><span class="n">WorkingSetSize</span><span class="p">;</span>
    <span class="n">peakMemoryUsed</span> <span class="o">=</span> <span class="n">procMemCounters</span><span class="p">.</span><span class="n">PeakWorkingSetSize</span><span class="p">;</span>
    <span class="n">pageFileUsed</span> <span class="o">=</span> <span class="n">procMemCounters</span><span class="p">.</span><span class="n">PagefileUsage</span><span class="p">;</span>
    <span class="n">peakPageFileUsed</span> <span class="o">=</span> <span class="n">procMemCounters</span><span class="p">.</span><span class="n">PeakPagefileUsage</span><span class="p">;</span>
<span class="cp">#elif defined Q_OS_LINUX
</span>    <span class="kt">char</span> <span class="n">file</span><span class="p">[</span><span class="mi">64</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span><span class="c1">//æä»¶å?
</span>    <span class="kt">FILE</span> <span class="o">*</span><span class="n">fd</span><span class="p">;</span>         <span class="c1">//å®ä¹æä»¶æéfd
</span>    <span class="kt">char</span> <span class="n">line_buff</span><span class="p">[</span><span class="mi">256</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>  <span class="c1">//è¯»åè¡çç¼å²å?    sprintf(file,"/proc/%ld/status", dwProcessId);//æä»¶ä¸­ç¬¬11è¡åå«ç
</span>
    <span class="n">fd</span> <span class="o">=</span> <span class="n">fopen</span> <span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s">"r"</span><span class="p">);</span> <span class="c1">//ä»¥Rè¯»çæ¹å¼æå¼æä»¶åèµç»æéfd
</span>    <span class="k">if</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">==</span> <span class="n">fd</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">256</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
    <span class="n">QString</span> <span class="n">sAddMemoryInfo</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="nb">NULL</span> <span class="o">!=</span> <span class="n">fgets</span><span class="p">(</span><span class="n">line_buff</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">line_buff</span><span class="p">),</span> <span class="n">fd</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">sscanf</span><span class="p">(</span><span class="n">line_buff</span><span class="p">,</span> <span class="s">"%s"</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">QString</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">==</span> <span class="n">QString</span><span class="p">(</span><span class="s">"Threads:"</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">sscanf</span><span class="p">(</span><span class="n">line_buff</span><span class="p">,</span> <span class="s">"%s %ld"</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dwThreadCount</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">QString</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">==</span> <span class="n">QString</span><span class="p">(</span><span class="s">"VmPeak:"</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">sscanf</span><span class="p">(</span><span class="n">line_buff</span><span class="p">,</span> <span class="s">"%s %ld"</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">peakMemoryUsed</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">QString</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">==</span> <span class="n">QString</span><span class="p">(</span><span class="s">"VmRSS:"</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">sscanf</span><span class="p">(</span><span class="n">line_buff</span><span class="p">,</span> <span class="s">"%s %ld"</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">memoryUsed</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">line_buff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'V'</span> <span class="o">&amp;&amp;</span> <span class="n">line_buff</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'m'</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">sAddMemoryInfo</span> <span class="o">+=</span> <span class="n">QString</span><span class="p">(</span><span class="n">line_buff</span><span class="p">);</span>
        <span class="p">}</span>

    <span class="p">}</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
    <span class="n">peakMemoryUsed</span> <span class="o">*=</span> <span class="mi">1024</span><span class="p">;</span>
    <span class="n">memoryUsed</span> <span class="o">*=</span> <span class="mi">1024</span><span class="p">;</span>
<span class="cp">#endif
</span></code></pre></div></div>

<h2 id="get-cpu-percentage-of-each-process">get cpu percentage of each process</h2>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kt">long</span> <span class="kt">long</span> <span class="n">curTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="cp">#ifdef Q_OS_WIN
</span>    <span class="n">HANDLE</span> <span class="n">hProcess</span> <span class="o">=</span> <span class="n">OpenProcess</span><span class="p">(</span><span class="n">PROCESS_QUERY_LIMITED_INFORMATION</span><span class="p">,</span> <span class="nb">false</span><span class="p">,</span> <span class="n">dwProcessId</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">==</span> <span class="n">hProcess</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">FILETIME</span> <span class="n">creationTime</span><span class="p">;</span>
    <span class="n">FILETIME</span> <span class="n">exitTime</span><span class="p">;</span>
    <span class="n">FILETIME</span> <span class="n">kernelTime</span><span class="p">;</span>
    <span class="n">FILETIME</span> <span class="n">userTime</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">false</span> <span class="o">==</span> <span class="n">GetProcessTimes</span><span class="p">(</span><span class="n">hProcess</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">creationTime</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">exitTime</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">kernelTime</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">userTime</span><span class="p">))</span>
         <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">filetimeToQDateTime</span><span class="p">(</span><span class="n">creationTime</span><span class="p">,</span> <span class="n">procStartTime</span><span class="p">);</span>
    <span class="n">procStartTime</span> <span class="o">=</span> <span class="n">procStartTime</span><span class="p">.</span><span class="n">addSecs</span><span class="p">(</span><span class="mi">3600</span> <span class="o">*</span> <span class="mi">8</span><span class="p">);</span>
    <span class="n">curTime</span> <span class="o">=</span> <span class="p">(</span><span class="n">transferFileTime</span><span class="p">(</span><span class="n">kernelTime</span><span class="p">)</span> <span class="o">+</span> <span class="n">transferFileTime</span><span class="p">(</span><span class="n">userTime</span><span class="p">))</span> <span class="o">/</span> <span class="n">m_nNumberOfProcessors</span><span class="p">;</span>

    <span class="n">FILETIME</span> <span class="n">sysTime</span><span class="p">;</span>
    <span class="n">GetSystemTimeAsFileTime</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sysTime</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">lastSysTime</span> <span class="o">||</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">lastTime</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//first time to calc
</span>        <span class="n">lastSysTime</span> <span class="o">=</span> <span class="n">transferFileTime</span><span class="p">(</span><span class="n">sysTime</span><span class="p">);</span>
        <span class="n">lastTime</span> <span class="o">=</span> <span class="n">curTime</span><span class="p">;</span>
        <span class="n">cpuPercentage</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">!=</span> <span class="n">transferFileTime</span><span class="p">(</span><span class="n">sysTime</span><span class="p">)</span> <span class="o">-</span> <span class="n">lastSysTime</span><span class="p">)</span>
        <span class="n">cpuPercentage</span> <span class="o">=</span> <span class="p">(</span><span class="n">curTime</span> <span class="o">-</span> <span class="n">lastTime</span><span class="p">)</span> <span class="o">*</span> <span class="mf">100.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">transferFileTime</span><span class="p">(</span><span class="n">sysTime</span><span class="p">)</span> <span class="o">-</span> <span class="n">lastSysTime</span><span class="p">);</span>

    <span class="n">lastSysTime</span> <span class="o">=</span> <span class="n">transferFileTime</span><span class="p">(</span><span class="n">sysTime</span><span class="p">);</span>
<span class="cp">#elif defined Q_OS_LINUX
</span>
<span class="cp">#define PROCESS_ITEM 14
</span>
    <span class="kt">char</span> <span class="n">file_name</span><span class="p">[</span><span class="mi">64</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>

    <span class="kt">FILE</span> <span class="o">*</span><span class="n">fd</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">line_buff</span><span class="p">[</span><span class="mi">1024</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
    <span class="n">sprintf</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span><span class="s">"/proc/%ld/stat"</span><span class="p">,</span> <span class="n">dwProcessId</span><span class="p">);</span>

    <span class="n">fd</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span><span class="s">"r"</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">nullptr</span> <span class="o">==</span> <span class="n">fd</span><span class="p">){</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">nCurUptime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">sysinfo</span> <span class="n">s_info</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">sysinfo</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s_info</span><span class="p">))</span>
        <span class="n">nCurUptime</span> <span class="o">=</span> <span class="n">s_info</span><span class="p">.</span><span class="n">uptime</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">userTime</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">systemTime</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">curUserTime</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">curSystemTime</span><span class="p">;</span>
    <span class="n">fgets</span><span class="p">(</span><span class="n">line_buff</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">line_buff</span><span class="p">),</span> <span class="n">fd</span><span class="p">);</span>

    <span class="n">sscanf</span><span class="p">(</span><span class="n">line_buff</span><span class="p">,</span><span class="s">"%ld"</span><span class="p">,</span><span class="o">&amp;</span><span class="n">dwProcessId</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">q</span> <span class="o">=</span><span class="n">getItems</span><span class="p">(</span><span class="n">line_buff</span><span class="p">,</span> <span class="n">PROCESS_ITEM</span><span class="p">);</span>
    <span class="n">sscanf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="s">"%d %d %d %d"</span><span class="p">,</span><span class="o">&amp;</span><span class="n">userTime</span><span class="p">,</span><span class="o">&amp;</span><span class="n">systemTime</span><span class="p">,</span><span class="o">&amp;</span><span class="n">curUserTime</span><span class="p">,</span><span class="o">&amp;</span><span class="n">curSystemTime</span><span class="p">);</span>

    <span class="n">q</span> <span class="o">=</span> <span class="n">getItems</span><span class="p">(</span><span class="n">line_buff</span><span class="p">,</span> <span class="n">PROCESS_ITEM</span> <span class="o">+</span> <span class="mi">8</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">nProcStartTime</span><span class="p">;</span>
    <span class="n">sscanf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="s">"%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nProcStartTime</span><span class="p">);</span>
    <span class="n">procStartTime</span> <span class="o">=</span> <span class="n">QDateTime</span><span class="o">::</span><span class="n">currentDateTime</span><span class="p">().</span><span class="n">addSecs</span><span class="p">(</span><span class="n">nProcStartTime</span> <span class="o">/</span> <span class="n">sysconf</span><span class="p">(</span><span class="n">_SC_CLK_TCK</span><span class="p">)</span> <span class="o">-</span> <span class="n">nCurUptime</span><span class="p">);</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>

    <span class="n">cpuPercentage</span> <span class="o">=</span> <span class="p">(</span><span class="n">userTime</span> <span class="o">+</span> <span class="n">systemTime</span><span class="p">)</span> <span class="o">*</span> <span class="mf">100.0</span> <span class="o">/</span> <span class="n">sysconf</span><span class="p">(</span><span class="n">_SC_CLK_TCK</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">nCurUptime</span> <span class="o">-</span> <span class="n">nProcStartTime</span> <span class="o">/</span> <span class="n">sysconf</span><span class="p">(</span><span class="n">_SC_CLK_TCK</span><span class="p">));</span>

    <span class="n">lastSysTime</span> <span class="o">=</span> <span class="n">systemTime</span><span class="p">;</span>
<span class="cp">#endif
</span>    <span class="n">lastTime</span> <span class="o">=</span> <span class="n">curTime</span><span class="p">;</span>
</code></pre></div></div>

<h2 id="get-all-threads-of-each-process">get all threads of each process</h2>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#ifdef Q_OS_WIN
</span>    <span class="n">THREADENTRY32</span> <span class="n">te</span><span class="p">;</span>
    <span class="n">te</span><span class="p">.</span><span class="n">dwSize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">THREADENTRY32</span><span class="p">);</span>

    <span class="n">HANDLE</span> <span class="n">hSnapshot</span> <span class="o">=</span> <span class="n">CreateToolhelp32Snapshot</span><span class="p">(</span><span class="n">TH32CS_SNAPTHREAD</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">INVALID_HANDLE_VALUE</span> <span class="o">==</span> <span class="n">hSnapshot</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="n">Thread32First</span><span class="p">(</span><span class="n">hSnapshot</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">te</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">do</span>
        <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">dwProcessId</span> <span class="o">==</span> <span class="n">te</span><span class="p">.</span><span class="n">th32OwnerProcessID</span><span class="p">)</span>
                <span class="n">vThreadId</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">te</span><span class="p">.</span><span class="n">th32ThreadID</span><span class="p">);</span>
        <span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="n">Thread32Next</span><span class="p">(</span><span class="n">hSnapshot</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">te</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="n">CloseHandle</span><span class="p">(</span><span class="n">hSnapshot</span><span class="p">);</span>
<span class="cp">#endif
</span></code></pre></div></div>

<h2 id="judge-a-process-alive-by-name">judge a process alive by name</h2>

<p>windows
loop each alive process to file the target one, need ntdll.dll</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">HANDLE</span> <span class="n">hSnapshot</span> <span class="o">=</span> <span class="n">CreateToolhelp32Snapshot</span><span class="p">(</span><span class="n">TH32CS_SNAPPROCESS</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">INVALID_HANDLE_VALUE</span> <span class="o">==</span> <span class="n">hSnapshot</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">PROCESSENTRY32</span> <span class="n">pe</span><span class="p">;</span>
    <span class="n">pe</span><span class="p">.</span><span class="n">dwSize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">PROCESSENTRY32</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">false</span> <span class="o">==</span> <span class="n">Process32First</span><span class="p">(</span><span class="n">hSnapshot</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pe</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">do</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="mi">0</span> <span class="o">!=</span> <span class="n">_stricmp</span><span class="p">(</span><span class="n">WcharToChar</span><span class="p">(</span><span class="n">pe</span><span class="p">.</span><span class="n">szExeFile</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">sProgramName</span><span class="p">.</span><span class="n">toStdString</span><span class="p">().</span><span class="n">c_str</span><span class="p">()))</span> <span class="k">continue</span><span class="p">;</span>

        <span class="n">HANDLE</span> <span class="n">hProc</span> <span class="o">=</span> <span class="n">OpenProcess</span><span class="p">(</span><span class="n">PROCESS_ALL_ACCESS</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">pe</span><span class="p">.</span><span class="n">th32ProcessID</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">INVALID_HANDLE_VALUE</span> <span class="o">==</span> <span class="n">hProc</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>

        <span class="n">HANDLE</span> <span class="n">hNewProcess</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
        <span class="n">PEB</span> <span class="n">peb</span><span class="p">;</span>
        <span class="n">RTL_USER_PROCESS_PARAMETERS</span> <span class="n">upps</span><span class="p">;</span>
        <span class="n">HMODULE</span> <span class="n">hModule</span> <span class="o">=</span> <span class="n">LoadLibrary</span><span class="p">(</span><span class="n">QString</span><span class="p">(</span><span class="s">"Ntdll.dll"</span><span class="p">).</span><span class="n">toStdWString</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>
        <span class="k">typedef</span> <span class="n">NTSTATUS</span><span class="p">(</span><span class="n">WINAPI</span> <span class="o">*</span><span class="n">NtQueryInformationProcessFace</span><span class="p">)(</span><span class="n">HANDLE</span><span class="p">,</span> <span class="n">DWORD</span><span class="p">,</span> <span class="n">PVOID</span><span class="p">,</span> <span class="n">ULONG</span><span class="p">,</span> <span class="n">PULONG</span><span class="p">);</span>
        <span class="n">NtQueryInformationProcessFace</span> <span class="n">NtQueryInformationProcess</span> <span class="o">=</span> <span class="p">(</span><span class="n">NtQueryInformationProcessFace</span><span class="p">)</span><span class="n">GetProcAddress</span><span class="p">(</span><span class="n">hModule</span><span class="p">,</span> <span class="s">"NtQueryInformationProcess"</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">DuplicateHandle</span><span class="p">(</span><span class="n">GetCurrentProcess</span><span class="p">(),</span> <span class="n">hProc</span><span class="p">,</span> <span class="n">GetCurrentProcess</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">hNewProcess</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">DUPLICATE_SAME_ACCESS</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">PROCESS_BASIC_INFORMATION</span> <span class="n">pbi</span><span class="p">;</span>
            <span class="n">NTSTATUS</span> <span class="n">isok</span> <span class="o">=</span> <span class="n">NtQueryInformationProcess</span><span class="p">(</span><span class="n">hNewProcess</span><span class="p">,</span> <span class="n">ProcessBasicInformation</span><span class="p">,</span> <span class="p">(</span><span class="n">PVOID</span><span class="p">)</span><span class="o">&amp;</span><span class="n">pbi</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">PROCESS_BASIC_INFORMATION</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">BCRYPT_SUCCESS</span><span class="p">(</span><span class="n">isok</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">ReadProcessMemory</span><span class="p">(</span><span class="n">hNewProcess</span><span class="p">,</span> <span class="n">pbi</span><span class="p">.</span><span class="n">PebBaseAddress</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">peb</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">PEB</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">ReadProcessMemory</span><span class="p">(</span><span class="n">hNewProcess</span><span class="p">,</span> <span class="n">peb</span><span class="p">.</span><span class="n">ProcessParameters</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">upps</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">RTL_USER_PROCESS_PARAMETERS</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>
                    <span class="p">{</span>
                        <span class="n">WCHAR</span> <span class="o">*</span><span class="n">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WCHAR</span><span class="p">[</span><span class="n">upps</span><span class="p">.</span><span class="n">CommandLine</span><span class="p">.</span><span class="n">Length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
                        <span class="n">ZeroMemory</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="p">(</span><span class="n">upps</span><span class="p">.</span><span class="n">CommandLine</span><span class="p">.</span><span class="n">Length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">WCHAR</span><span class="p">));</span>
                        <span class="n">ReadProcessMemory</span><span class="p">(</span><span class="n">hNewProcess</span><span class="p">,</span> <span class="n">upps</span><span class="p">.</span><span class="n">CommandLine</span><span class="p">.</span><span class="n">Buffer</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">upps</span><span class="p">.</span><span class="n">CommandLine</span><span class="p">.</span><span class="n">Length</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

                        <span class="n">QString</span> <span class="n">qsProcParam</span> <span class="o">=</span> <span class="n">QString</span><span class="o">::</span><span class="n">fromWCharArray</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">upps</span><span class="p">.</span><span class="n">CommandLine</span><span class="p">.</span><span class="n">Length</span><span class="p">).</span><span class="n">toUtf8</span><span class="p">();</span>
                        <span class="k">delete</span> <span class="n">buffer</span><span class="p">;</span>
                        <span class="n">QStringList</span> <span class="n">qslProcParam</span> <span class="o">=</span> <span class="n">qsProcParam</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="sc">' '</span><span class="p">,</span> <span class="n">QString</span><span class="o">::</span><span class="n">SkipEmptyParts</span><span class="p">);</span>

                        <span class="k">if</span> <span class="p">(</span><span class="n">qslProcParam</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="n">qslStartParam</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="p">{</span>
                            <span class="kt">int</span> <span class="n">nPos</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                            <span class="k">for</span> <span class="p">(</span><span class="n">QString</span> <span class="n">sParam</span> <span class="o">:</span> <span class="n">qslStartParam</span><span class="p">)</span>
                            <span class="p">{</span>
                                <span class="k">if</span> <span class="p">(</span><span class="n">qslProcParam</span><span class="p">[</span><span class="n">nPos</span><span class="p">]</span> <span class="o">!=</span> <span class="n">sParam</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
                                <span class="n">nPos</span><span class="o">++</span><span class="p">;</span>
                            <span class="p">}</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">nPos</span> <span class="o">==</span> <span class="n">qslProcParam</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
                                <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="n">CloseHandle</span><span class="p">(</span><span class="n">hNewProcess</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">CloseHandle</span><span class="p">(</span><span class="n">hProc</span><span class="p">);</span>
    <span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="n">Process32Next</span><span class="p">(</span><span class="n">hSnapshot</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pe</span><span class="p">));</span>

    <span class="n">CloseHandle</span><span class="p">(</span><span class="n">hSnapshot</span><span class="p">);</span>
</code></pre></div></div>
<p>linux
loop each file under /proc to find the target one</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">256</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
    <span class="n">QDir</span> <span class="n">dir</span><span class="p">(</span><span class="s">"/proc"</span><span class="p">);</span>
    <span class="n">dir</span><span class="p">.</span><span class="n">setFilter</span><span class="p">(</span><span class="n">QDir</span><span class="o">::</span><span class="n">Dirs</span><span class="p">);</span>
    <span class="n">QFileInfoList</span> <span class="n">fileInfoList</span> <span class="o">=</span> <span class="n">dir</span><span class="p">.</span><span class="n">entryInfoList</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">QFileInfo</span> <span class="n">file</span> <span class="o">:</span> <span class="n">fileInfoList</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">FILE</span> <span class="o">*</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">((</span><span class="n">file</span><span class="p">.</span><span class="n">absoluteFilePath</span><span class="p">()</span> <span class="o">+</span> <span class="s">"/status"</span><span class="p">).</span><span class="n">toStdString</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span> <span class="s">"r"</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">==</span> <span class="n">fp</span><span class="p">)</span>
            <span class="k">continue</span><span class="p">;</span>

        <span class="n">fgets</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
        <span class="kt">char</span> <span class="n">key</span><span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="n">value</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
        <span class="n">sscanf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">"%s %s"</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
        <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">QString</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="n">sProgramName</span><span class="p">)</span>
            <span class="k">continue</span><span class="p">;</span>

        <span class="kt">int</span> <span class="n">pid</span> <span class="o">=</span> <span class="n">file</span><span class="p">.</span><span class="n">fileName</span><span class="p">().</span><span class="n">toInt</span><span class="p">();</span>
        <span class="kt">FILE</span> <span class="o">*</span><span class="n">cmdfp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">QString</span><span class="p">().</span><span class="n">sprintf</span><span class="p">(</span><span class="s">"/proc/%d/cmdline"</span><span class="p">,</span> <span class="n">pid</span><span class="p">).</span><span class="n">toStdString</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span> <span class="s">"r"</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">==</span> <span class="n">cmdfp</span><span class="p">)</span>
            <span class="k">continue</span><span class="p">;</span>

        <span class="n">memset</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">);</span>
        <span class="n">fgets</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="n">cmdfp</span><span class="p">);</span>
        <span class="n">QString</span> <span class="n">qsProcParam</span> <span class="o">=</span> <span class="n">QString</span><span class="o">::</span><span class="n">fromUtf8</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="mi">256</span><span class="p">);</span>
        <span class="n">QStringList</span> <span class="n">qslProcParam</span> <span class="o">=</span> <span class="n">qsProcParam</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="n">QChar</span><span class="p">(</span><span class="sc">'\0'</span><span class="p">),</span> <span class="n">QString</span><span class="o">::</span><span class="n">SkipEmptyParts</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">qslProcParam</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="n">qslStartParam</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">nPos</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">QString</span> <span class="n">sParam</span> <span class="o">:</span> <span class="n">qslStartParam</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">qslProcParam</span><span class="p">[</span><span class="n">nPos</span><span class="p">]</span> <span class="o">!=</span> <span class="n">sParam</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
                <span class="n">nPos</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">nPos</span> <span class="o">==</span> <span class="n">qslProcParam</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
                <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">fclose</span><span class="p">(</span><span class="n">cmdfp</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div></div>

<h2 id="get-handle-and-handle-count">get handle and handle count</h2>
<p>windows</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">hProcess</span> <span class="o">=</span> <span class="n">OpenProcess</span><span class="p">(</span><span class="n">PROCESS_QUERY_LIMITED_INFORMATION</span><span class="p">,</span> <span class="nb">false</span><span class="p">,</span> <span class="n">dwProcessId</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">!=</span> <span class="n">hProcess</span><span class="p">)</span>
        <span class="n">GetProcessHandleCount</span><span class="p">(</span><span class="n">hProcess</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dwHandleCount</span><span class="p">);</span>
</code></pre></div></div>

<p><a href="./">back</a></p>

<hr />
<p>layout: default</p>

      </section>
    </div>

    
  </body>
</html>
