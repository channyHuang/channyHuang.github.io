---
layout: default
title: CShape
categories:
- C++
tags:
- C++
---
//Description:

//Create Date: 2020-11-02 07:58:35

//Author: channy

# CShape

# Outlook Add-in



## Explorer和Inspector

getActiveWindow()不一定获取的是当前活动窗口



复现路径: 打开一个Outlook主窗口->新建邮件弹出邮件子窗口1->再新建邮件弹出邮件子窗口2->来回切换这三个窗口->



```

if (this.RibbonId == "Microsoft.Outlook.Mail.Compose")

{

	var win = Globals.ThisAddIn.Application.ActiveInspector();

	string Name = win.GetType().InvokeMember("Caption", System.Reflection.BindingFlags.GetProperty, null, win, null).ToString();

	index = (int)FindWindow("rctrl_renwnd32\0", Name);

}

else if (this.RibbonId == "Microsoft.Outlook.Explorer")

{

	var win = Globals.ThisAddIn.Application.ActiveExplorer();

	string Name = win.GetType().InvokeMember("Caption", System.Reflection.BindingFlags.GetProperty, null, win, null).ToString();

	index = (int)FindWindow("rctrl_renwnd32\0", Name);

}

```



## RibbonType



Microsoft.Outlook.Appointment 事件

Microsoft.Outlook.Task 任务

Microsoft.Outlook.Contact 联系人

Microsoft.Outlook.DistributionList 联系人组

Microsoft.Outlook.Mail.Compose 写新邮件、回复邮件、转发邮件

Microsoft.Outlook.Mail.Read 收到的邮件、已发送的邮件



## Ribbon_Load

Word是所有窗口共用一个ribbon类，只Load一次



Outlook是每个窗口会Load一次ribbon



## publish后setup问题



修改过程序集的名称后会出现安装不上的问题，“无法安装此应用程序，因为已安装具有相同标识的应用程序”



```

VSTOInstaller.exe /Uninstall file:///D:/YoudaoOfficeAddIn/YdOutlookAddIn/YdOutlookAddIn.vsto



C:\Program Files (x86)\Microsoft SDKs\Windows\v10.0A\bin>"NETFX 4.8 Tools\mage.exe" -cc



计算机\HKEY_CURRENT_USER\Software\Classes\Software\Microsoft\Windows\CurrentVersion\Deployment\SideBySide\2.0\StateManager

```

用自带的ClickOnce总会出现各种各样的问题，改用Advance Installer了。

c#生成的动态库，打包时一定一定要带上。缺少动态库的情况下，插件在别的机器上只会报崩溃，然后被禁用，除此之外没有任何提示。。。

如果调度机器没有问题，但测试机器有问题，那么有很大可能是打包问题，注意依赖库！

[back](/)

